# Обеспечение плавности движения сервоприводов

## Проблема
Движения сервоприводов были прерывистыми из-за:
1. Большого шага изменения позиции за одно обновление
2. Слишком большой задержки обновления (100мс)
3. Отсутствия интерполяции между позициями

## Решение
Внедрены следующие улучшения:

### 1. Увеличена частота обновлений
- Изменен `update_delay` с 0.1 до 0.02 секунды (50 FPS)
- Это обеспечивает более плавное обновление позиций

### 2. Ограничение максимального шага
- Добавлен параметр `max_step` (по умолчанию 2.0 градуса)
- Позиция меняется не более чем на `max_step` за одно обновление
- Это предотвращает резкие скачки

### 3. Плавный переход к целевой позиции
- Добавлен `target_position` для отложенного движения
- При вызове `set_position()` ось плавно движется к целевой позиции
- Движение останавливается при достижении цели (с зоной нечувствительности 0.1 градуса)

### 4. Улучшенное swing движение
- Скорость swing теперь ограничена `max_step`
- Более плавные переходы направления

## Новые API endpoint'ы

### Настройка плавности движения
```
POST /api/servo/smoothness/{max_step}
```
Где `max_step` - максимальный шаг в градусах за одно обновление.

**Примеры:**
- `/api/servo/smoothness/1.0` - очень плавное движение
- `/api/servo/smoothness/5.0` - быстрое движение
- `/api/servo/smoothness/0.5` - максимально плавное движение

### Настройка частоты обновлений
```
POST /api/servo/delay/{delay}
```
Где `delay` - задержка между обновлениями в секундах.

**Примеры:**
- `/api/servo/delay/0.01` - 100 FPS (очень плавно)
- `/api/servo/delay/0.02` - 50 FPS (по умолчанию)
- `/api/servo/delay/0.05` - 20 FPS (экономия ресурсов)

## Мониторинг
Статус осей теперь включает дополнительную информацию:
```json
{
  "name": "Axis 0",
  "velocity": 1.5,
  "position": 45.2,
  "target_position": 90.0,
  "movement": null,
  "max_step": 2.0
}
```

## Рекомендации для настройки

### Для максимальной плавности:
```bash
curl -X POST http://192.168.99.15:3001/api/servo/delay/0.01
curl -X POST http://192.168.99.15:3001/api/servo/smoothness/0.5
```

### Для баланса плавности и производительности:
```bash
curl -X POST http://192.168.99.15:3001/api/servo/delay/0.02
curl -X POST http://192.168.99.15:3001/api/servo/smoothness/2.0
```

### Для быстрого движения:
```bash
curl -X POST http://192.168.99.15:3001/api/servo/delay/0.05
curl -X POST http://192.168.99.15:3001/api/servo/smoothness/5.0
```

## Тестирование
Проверьте плавность движения:
```bash
# Установить плавное движение
curl -X POST http://192.168.99.15:3001/api/servo/smoothness/1.0

# Переместить ось в позицию 90 градусов
curl -X POST http://192.168.99.15:3001/api/servo/0/position/90

# Установить постоянную скорость
curl -X POST http://192.168.99.15:3001/api/servo/0/velocity/2.0
```
